var app=angular.module("myApp",["ngRoute"]);app.controller("homeCtrl",["$scope","loginService","sessionService",function(t,e,n){t.username=n.get("name"),t.tf=e.isLogged(),t.logout=function(){e.logout()}}]),app.controller("loginCtrl",["$scope","loginService",function(t,e){"use strict";t.login=function(t){e.login(t)},t.register=function(t){e.register(t)}}]),app.controller("productsCtrl",["$scope","productsService",function(t,e){"use strict";e.products().success(function(n){t.products=n,t.comments=[],angular.forEach(n,function(n){e.comments(n.id).success(function(e){t.comments.push(e)})})}),t.mycomment=function(n,o){e.mycomment(n,o).success(function(o){o.success?e.comments(n).success(function(e){t.comments[n-1]=e}):console.log("error")})}}]),app.directive("commentsDirective",[function(){return{templateUrl:"views/tmp/comments.tmp.html"}}]),app.directive("loginDirective",[function(){return{templateUrl:"views/tmp/login.tmp.html"}}]),app.directive("newcommentDirective",[function(){return{templateUrl:"views/tmp/newcomment.tmp.html"}}]),app.directive("productsDirective",[function(){return{templateUrl:"views/tmp/products.tmp.html",controller:"productsCtrl"}}]),app.config(["$routeProvider",function(t){"use strict";t.when("/",{templateUrl:"./views/home.html",controller:"homeCtrl"}).when("/login",{templateUrl:"./views/login.html",controller:"loginCtrl"}).otherwise({redirectTo:"/login"})}]),app.factory("loginService",["$http","$location","sessionService",function(t,e,n){"use strict";return{login:function(o){return t.post("http://smktesting.herokuapp.com/api/login/",o).then(function(t){t.data.success?(n.set("user",t.data.token),n.set("name",o.username),e.path("/")):(console.log("error"),e.path("/login"))})},register:function(o){return t.post("http://smktesting.herokuapp.com/api/register/",o).then(function(t){t.data.success?(n.set("user",t.data.token),n.set("name",o.username),e.path("/")):e.path("/login")})},logout:function(){n.destroy("user"),n.destroy("name"),e.path("/login")},isLogged:function(){return!!n.get("user")}}}]),app.service("productsService",["$http","sessionService",function(t,e){"use strict";this.products=function(){return t.get("http://smktesting.herokuapp.com/api/products/")},this.comments=function(e){return t.get("http://smktesting.herokuapp.com/api/reviews/"+e)},this.mycomment=function(n,o){return t.post("http://smktesting.herokuapp.com//api/reviews/"+n,o,{headers:{Authorization:"Token "+e.get("user")}})}}]),app.factory("sessionService",["$http",function(t){return{set:function(t,e){return sessionStorage.setItem(t,e)},get:function(t){return sessionStorage.getItem(t)},destroy:function(t){return sessionStorage.removeItem(t)}}}]);